version: "3"

services:
  storefront:
    container_name: storefront
    build:
      context: .
      dockerfile: Dockerfile.base
      args:
        - SALEOR_API_URL=http://localhost:8000/graphql/ # handled by nginx
        - STOREFRONT_URL=http://localhost:3000
        - CLOUD_DEPLOYMENT_URL=
    ports:
      - 3000:3000
    networks:
      - saleor-platform_saleor-backend-tier
    command: sh -c '(nginx &) && pnpm turbo run start --filter=storefront...'
  products-importer:
    container_name: products-importer
    build:
      context: .
      dockerfile: Dockerfile.base
      args:
        - SALEOR_API_URL=http://localhost:8000/graphql/ # handled by nginx
        - PRODUCTS_IMPORTER_URL=http://localhost:3004
        - STOREFRONT_URL=http://localhost:3000
        - CLOUD_DEPLOYMENT_URL=
    ports:
      - 3004:3004
    networks:
      - saleor-platform_saleor-backend-tier
    command: sh -c '(nginx &) && pnpm turbo run start --filter=products-importer...'

networks:
  saleor-platform_saleor-backend-tier:
    external: true